<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
<head>
<title>Test</title>
<meta name="viewport" content="target- densitydpi=device-dpi, width=device-width, user-scalable=no"/>
<link rel="stylesheet" type="text/css" href="/jmi-canvas/src/main/resources/jmi-client/css/jmi-client.css" />

<script type="text/javascript" src="/jmi-canvas/src/main/js/jmi.js"></script>
<script type="text/javascript" src="/jmi-canvas/src/main/js/lib/json_sans_eval.js"></script>

<script type="text/javascript" src="/jmi-canvas/src/main/js/script/ActiveZone.js"></script>
<script type="text/javascript" src="/jmi-canvas/src/main/js/script/BagZone.js"></script>
<script type="text/javascript" src="/jmi-canvas/src/main/js/script/Base.js"></script>
<script type="text/javascript" src="/jmi-canvas/src/main/js/script/ColorX.js"></script>
<script type="text/javascript" src="/jmi-canvas/src/main/js/script/Dimension.js"></script>
<script type="text/javascript" src="/jmi-canvas/src/main/js/script/Env.js"></script>
<script type="text/javascript" src="/jmi-canvas/src/main/js/script/FontX.js"></script>
<script type="text/javascript" src="/jmi-canvas/src/main/js/script/HTMLText.js"></script>
<script type="text/javascript" src="/jmi-canvas/src/main/js/script/Insets.js"></script>
<script type="text/javascript" src="/jmi-canvas/src/main/js/script/LinkZone.js"></script>
<script type="text/javascript" src="/jmi-canvas/src/main/js/script/MenuX.js"></script>
<script type="text/javascript" src="/jmi-canvas/src/main/js/script/Plan.js"></script>
<script type="text/javascript" src="/jmi-canvas/src/main/js/script/PlanContainer.js"></script>
<script type="text/javascript" src="/jmi-canvas/src/main/js/script/Point.js"></script>
<script type="text/javascript" src="/jmi-canvas/src/main/js/script/Polygon.js"></script>
<script type="text/javascript" src="/jmi-canvas/src/main/js/script/Rectangle.js"></script>
<script type="text/javascript" src="/jmi-canvas/src/main/js/script/SatData.js"></script>
<script type="text/javascript" src="/jmi-canvas/src/main/js/script/Satellite.js"></script>
<script type="text/javascript" src="/jmi-canvas/src/main/js/script/ShapeX.js"></script>
<script type="text/javascript" src="/jmi-canvas/src/main/js/script/Slice.js"></script>
<script type="text/javascript" src="/jmi-canvas/src/main/js/script/Swatch.js"></script>
<script type="text/javascript" src="/jmi-canvas/src/main/js/script/TipTimer.js"></script>
<script type="text/javascript" src="/jmi-canvas/src/main/js/script/Token.js"></script>
<script type="text/javascript" src="/jmi-canvas/src/main/js/script/Transfo.js"></script>
<script type="text/javascript" src="/jmi-canvas/src/main/js/script/VContainer.js"></script>
<script type="text/javascript" src="/jmi-canvas/src/main/js/script/Watermark.js"></script>

<script type="text/javascript" src="/jmi-canvas/src/main/js/util/ImageUtil.js"></script>
<script type="text/javascript" src="/jmi-canvas/src/main/js/util/EventManager.js"></script>

<script type="text/javascript" src="/jmi-canvas/src/main/js/components/MapRequester.js"></script>
<script type="text/javascript" src="/jmi-canvas/src/main/js/components/CanvasMap.js"></script>

<script type="text/javascript" src="/jmi-canvas/src/main/js/lib/swfobject.js"></script>
<script type="text/javascript" src="/jmi-canvas/src/main/js/lib/object-watch.js"></script>
<script type="text/javascript" src="/jmi-canvas/src/main/js/components/SwfMap.js"></script>

<script type="text/javascript" src="/jmi-canvas/src/main/js/components/Attribute.js"></script>
<script type="text/javascript" src="/jmi-canvas/src/main/js/components/Entity.js"></script>
<script type="text/javascript" src="/jmi-canvas/src/main/js/components/Node.js"></script>
<script type="text/javascript" src="/jmi-canvas/src/main/js/components/Link.js"></script>
<script type="text/javascript" src="/jmi-canvas/src/main/js/components/Selection.js"></script>

<script type="text/javascript" src="/jmi-canvas/src/main/js/extensions/Breadcrumb.js"></script>
<script type="text/javascript" src="/jmi-canvas/src/main/js/extensions/Slideshow.js"></script>

<script>
var breadcrumbTitles = { shortTitle: 'Carte principale', longTitle: '' };
var map;
function breadcrumbTitlesFunc(event) {
	if( event.type === JMI.Map.event.EMPTY) {
		return {shortTitle: 'Sorry, the map is empty. Does the feed contains categories?', longTitle: 'Sorry, the map is empty. Does the feed contains categories?'};
	}
	if( event.type === JMI.Map.event.ERROR) {
		return {shortTitle: 'Sorry, an error occured: '  + event.message, longTitle: 'Sorry, an error occured. Error: ' + event.message};
	}
	return breadcrumbTitles;
}
function getParams() {
	
	return {
		map: 'GoogleVisualization',
		invert: 'false',
    	//spreadsheetserverurl: 'http://localhost:8080/web-labs',
    	spreadsheetserverurl: 'http://labs.just-map-it.com',
		source: 'TEST',
		sourceId: 'Franck',
		inverted: false,
		data: '{"entities":[{"id":1,"name":"France","attributes":[{"id":2,"p":8}]},{"id":2,"name":"Espagne ","attributes":[{"id":1},{"id":2},{"id":3}]},{"id":3,"name":"Italie","attributes":[{"id":3}]}],"attributes":[{"id":1,"name":"Europe","checked":true},{"id":2,"name":"Asie","checked":false},{"id":3,"name":"Afrique","checked":false}]}'
    };
	/*return {
		map: 'Feeds',
		invert: 'false',
    	feedsserverurl: 'http://feeds.just-map-it.com',
		feed: 'http://www.social-computing.com/feed/',
		track: '',
		jsessionid: '',
		site: ''
    };*/
	/*return {
		map: 'PolySpot',
		inverted: 'false',
    	polyspotserverurl: 'http://localhost:8080/web-labs',
    	//polyspotserverurl: 'http://labs.just-map-it.com',
		sources: ',1014,',
		fields: ',semantic-theme-label,person-label,organization-organisation-label',
		query: 'wind',
		//C1: '#eeeeee',
		jsessionid: ''
    };*/
};
function GoMap() {
	var parameters = getParams();
	parameters.analysisProfile= 'GlobalProfile';
	map = JMI.Map({
				parent: 'map', 
				clientUrl: '/jmi-canvas/src/main/resources/jmi-client',
				//method: 'POST'
				//touchMenuDelay : 1000
    			//server: 'http://localhost:8080/jmi-server/',
				//server: 'http://server.just-map-it.com/', 
				//client: JMI.Map.SWF,
				watermark: {fontSize: 14}
			});
	map.addEventListener(JMI.Map.event.STATUS, function(event) {
		//document.getElementById('status').innerHTML = event.message;
	} );
	map.addEventListener(JMI.Map.event.ACTION, function(event) {
		window[event.fn](event.map, event.args);
	} );
	map.addEventListener(JMI.Map.event.ERROR, function(event) {
		//alert( event.message);
	} );
	map.addEventListener(JMI.Map.event.READY, function(event) {
		document.getElementById('status').innerHTML = event.map.type;
	} );
	map.addEventListener(JMI.Map.event.ATTRIBUTE_CLICK, function(event) {
		//alert( event.attribute.props.NAME);
	} );
	map.addEventListener(JMI.Map.event.ATTRIBUTE_HOVER, function(event) {
		document.getElementById('status').innerHTML = event.attribute._index;
	} );
	map.addEventListener(JMI.Map.event.LINK_HOVER, function(event) {
		document.getElementById('status').innerHTML = event.link._index;
	} );
	var breadcrumb = new JMI.extensions.Breadcrumb('breadcrumb',map,{namingFunc:breadcrumbTitlesFunc,thumbnail:{}});
	//var slideshow = new JMI.extensions.Slideshow(map);
	//var slideshow = new JMI.extensions.Slideshow(map,'slideshow',200,200,600);
	map.compute(parameters);
};
function JMIF_Navigate(args) {
	alert( args[0]);
};
function JMIF_Focus(map, args) {
	breadcrumbTitles.shortTitle = 'Focus';
	breadcrumbTitles.longTitle = 'Focus on: ' + args[1];
	var parameters = getParams();
	parameters.entityId = args[0];
	parameters.feed = args[2];
	map.compute( parameters);
}
function JMIF_Center(map, args) {
	breadcrumbTitles.shortTitle = 'Center';
	breadcrumbTitles.longTitle = 'Center on: ' + args[1];
	var parameters = getParams();
	parameters.attributeId = args[0];
	parameters.feed = args[2];
	parameters.analysisProfile = "DiscoveryProfile";
	map.compute( parameters);
}
function JMIF_Check(map, args) {
	var pattern = new RegExp('\\b' + args[0] + '\\b'); 
	var res = map.attributes.match(pattern,['ID']);	
	res[0].CHECKED = !res[0].CHECKED;
}
function image() {
	document.location.href = map.getImage("image/png", 200, 200, true);
};
function data() {
	document.location.href = map.getData();
};
function search(value) {
	var res1 = map.attributes.match(value,['NAME']);	
	var res2 = map.links.match(value,['REC_NAME']);	
	document.getElementById('res').innerHTML = res1.length + ' attribute(s) found / ' + res2.length + ' link(s) found'; 
	map.selections['search'].set( res1.concat(res2));
	map.selections['search'].show();
};
</script>
</head>
<body onload="GoMap()">
<div>
	<ul>
		<li>element 1</li>
		<li>element 2</li>
		<li>element 1</li>
		<li>element 2</li>
		<li>element 1</li>
		<li>element 2</li>
		<li>element 1</li>
		<li>element 2</li>
		<li>element 1</li>
		<li>element 2</li>
		<li>element 1</li>
		<li>element 2</li>
	</ul>
</div>
<div>
<div id="breadcrumb">&nbsp;</div>
<div id="map" style="border:1px solid black ;width: 640px ;height: 480px; " ></div>
<button onclick="map.resize(900,480);">Resize</button>
<button onclick="image();">Image</button>
<button onclick="data();">Data</button>
<input onkeyup="search(this.value)"/><span id="res"></span>
<div id="status">&nbsp;</div>
<!--menu type='context' id='toto' >
 <menuitem label="powered by Just Map It!" onclick="alert('rotate');"/>
</menu-->
</div>
<div id="slideshow" style="visibility:hidden;">
	<ul>
		<li>Hello</li>
		<li>Hello World!</li>
		<li>PPPPPPPPPP PPPPPPPPPPPPPPP!</li>
	</ul>
</div>
</body>
</html>